<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
  crossorigin="anonymous"></script>

<script type="text/javascript">

Array.prototype.forEach = function(callback)
{
    for (var key in this) {
        var item = this[key];
        callback(item);
    }
};

var denominations = [
	'2',
	'3',
	'4',
	'5',
	'6',
	'7',
	'8',
	'9',
	'jack',
	'queen',
	'king',
	'ace',
];

var suits = [
	'clubs',
	'diamonds',
	'hearts',
	'spades'
];

var Deck = function(cards)
{
    this.cards = cards;
};

Deck.makeNew = function()
{
    var cards = [];

    suits.forEach(suit => {
        denominations.forEach(denomination => {
            cards.push(denomination + '_of_' + suit);
        });
    });

    var deck = new Deck(cards);
    deck.shuffle();
    return deck;
};

Deck.prototype.shuffle = function()
{
    function shuffle (array)
    {
        var currentIndex = array.length;
        var temporaryValue, randomIndex;

        while (0 !== currentIndex) {
            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }

    shuffle(this.cards);
};


Deck.prototype.dealHands = function(players)
{
    var hands = [];
    for (var i = 0; i < players; i++) {
        hands[i] = this.dealHand();
    }
    return hands;
};

Deck.prototype.dealHand = function()
{
    var card1 = this.cards.pop();
    var card2 = this.cards.pop();
    return [card1, card2];
};

Deck.prototype.dealFlop = function()
{
    var card1 = this.cards.pop();
    var card2 = this.cards.pop();
    var card3 = this.cards.pop();
    return [card1, card2, card3];
};

Deck.prototype.dealTurn = function()
{
    return this.cards.pop();
};

Deck.prototype.dealRiver = function()
{
    return this.cards.pop();
};

var Controller = {};

/**
 * @param deck {Deck}
 * @param players {int}
 */
Controller.startGame = function(deck, players)
{
    View.clearTable();
    View.renderPlayers(players);

    var hands = deck.dealHands(players);

    for (var i = 0; i < players; i++ ) {
        var hand = hands[i];
        View.renderPlayerHand(i, hand);
    }
};

/**
 * @param deck {Deck}
 * @param playerId {int}
 */
Controller.dealHandToPlayer = function(deck, playerId)
{
    var cards = deck.dealHand();
    View.renderPlayerHand(playerId, cards);
};

/**
 * @param deck {Deck}
 */
Controller.dealFlop = function(deck)
{
    var flop = deck.dealFlop();
    View.renderFlop(flop);
};

/**
 * @param deck {Deck}
 */
Controller.dealTurn = function(deck)
{
    var card = deck.dealTurn();
    View.renderTurn(card);
};

/**
 * @param deck {Deck}
 */
Controller.dealRiver = function(deck)
{
    var card = deck.dealRiver();
    View.renderRiver(card);
};

var View = {};

View.renderPlayers = function(players)
{
	for (var i = 0; i < players; i++) {
	    View.renderPlayer(i);
	}
};

View.renderPlayer = function(playerId)
{
    var player = "<div style='float:left; margin-right: 20px;'>Player " + (playerId + 1) + ": <br><span id='player-" + playerId + "'></span></div>"
    $('#hands').append(player);
};

View.renderPlayerHand = function(playerId, cards)
{
    var hand = View.renderCards(cards);
    $('#player-' + playerId).html(hand);
};

View.renderFlop = function(flop)
{
    $('#cards').html(View.renderCards(flop));
};

View.renderTurn = function(card)
{
    $('#cards').html( $('#cards').html() + View.renderCards([card]));
};

View.renderRiver = function(card)
{
    $('#cards').html( $('#cards').html() + View.renderCards([card]));
};

View.clearTable = function()
{
	$('#cards').html('');
    $('#hands').html('');
};

View.renderCards = function(cards)
{
    return cards.map(function(card){
        return View.renderCard(card);
    });
};

View.renderCard = function(card)
{
    return '<img src="images/' + card + '.png" style="width: 80px; height: auto; border: 1px solid #aaa; margin: 5px;"/>';
};


$(function(){

	var players = 5;
	var deck;

	$("#deal").click(function(){
        deck = Deck.makeNew();
        Controller.startGame(deck, players);
	});
	$("#flop").click(function(){
        Controller.dealFlop(deck);
	});
	$("#turn").click(function(){
        Controller.dealTurn(deck);
	});
	$("#river").click(function(){
        Controller.dealRiver(deck);
	});
});

</script>
</head>
<body>

<h3>Cards</h3>
<div id="cards">

</div>

<h3>Players</h3>
<div id="hands">

</div>
<div style="clear:both"></div>
<br><br>
<button id="deal">Deal</button>
<button id="flop">Flop</button>
<button id="turn">Turn</button>
<button id="river">River</button>

</body>
</html>