<html>
<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script type="text/javascript">

Array.prototype.forEach = function(callback)
{
    for (var key in this) {
        var item = this[key];
        callback(item);
    }
};

var Deck = function(jquery)
{
    this.jquery = jquery;
};

Deck.prototype.dealHands = function(players, handler)
{
    this.jquery.post("api/deal/" + players, function(data) {
        handler(data);
    });
};

Deck.prototype.dealFlop = function(handler)
{
    this.jquery.post("api/flop/", function(data) {
        handler(data);
    });
};

Deck.prototype.dealTurn = function(handler)
{
    this.jquery.post("api/turn/", function(data) {
        handler(data);
    });
};

Deck.prototype.dealRiver = function(handler)
{
    this.jquery.post("api/river/", function(data) {
        handler(data);
    });
};

var Controller = {};

/**
 * @param deck {Deck}
 * @param players {int}
 */
Controller.startGame = function(deck, players)
{
    View.clearTable();
    View.renderPlayers(players);

    deck.dealHands(players, function(hands){
        for (var i = 0; i < players; i++ ) {
            var hand = hands[i];
            View.renderPlayerHand(i, hand);
        }
    });
};

/**
 * @param deck {Deck}
 */
Controller.dealFlop = function(deck)
{
    deck.dealFlop(function(flop){
        View.renderFlop(flop);
    });
};

/**
 * @param deck {Deck}
 */
Controller.dealTurn = function(deck)
{
    deck.dealTurn(function(turn){
        View.renderTurn(turn);
    });
};

/**
 * @param deck {Deck}
 */
Controller.dealRiver = function(deck)
{
    deck.dealRiver(function(river){
        View.renderRiver(river);
    });
};

var View = {};

View.renderPlayers = function(players)
{
	for (var i = 0; i < players; i++) {
	    View.renderPlayer(i);
	}
};

View.renderPlayer = function(playerId)
{
    var player = "<div style='float:left; margin-right: 20px;'>Player " + (playerId + 1) + ": <br><span id='player-" + playerId + "'></span></div>"
    $('#hands').append(player);
};

View.renderPlayerHand = function(playerId, cards)
{
    var hand = View.renderCards(cards);
    $('#player-' + playerId).html(hand);
};

View.renderFlop = function(flop)
{
    $('#cards').html(View.renderCards(flop));
};

View.renderTurn = function(card)
{
    $('#cards').html( $('#cards').html() + View.renderCards([card]));
};

View.renderRiver = function(card)
{
    $('#cards').html( $('#cards').html() + View.renderCards([card]));
};

View.clearTable = function()
{
	$('#cards').html('');
    $('#hands').html('');
};

View.renderCards = function(cards)
{
    return cards.map(function(card){
        return View.renderCard(card);
    });
};

View.renderCard = function(card)
{
    return '<img src="images/' + card + '.png" style="width: 80px; height: auto; border: 1px solid #aaa; margin: 5px;"/>';
};


$(function(){

	var players = 5;
	var deck;

	$("#deal").click(function(){
        deck = new Deck($);
        Controller.startGame(deck, players);
	});
	$("#flop").click(function(){
        Controller.dealFlop(deck);
	});
	$("#turn").click(function(){
        Controller.dealTurn(deck);
	});
	$("#river").click(function(){
        Controller.dealRiver(deck);
	});
});

</script>
</head>
<body>

<h3>Cards</h3>
<div id="cards">

</div>

<h3>Players</h3>
<div id="hands">

</div>
<div style="clear:both"></div>
<br><br>
<button id="deal">Deal</button>
<button id="flop">Flop</button>
<button id="turn">Turn</button>
<button id="river">River</button>

</body>
</html>